<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>端API</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <style>
        body {
            background: #fff;
        }

        div {
            font-size: 16px;
        }

        .left {
            display: inline;
            width: 20%;
            line-height: 50px;
            margin: 10px 10% 0 10%;
        }

        .fill {
            width: 100%;
        }
        /*方框框*/

        .right {
            margin: 0 10% 0 0;
            width: 50%;
        }

        .border div {
            font-size: 15px;
            line-height: 37px;
        }
    </style>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/jquery-1.4.2.min.js"></script>
    <script type="text/javascript">
    function closewin(){
      window.opener=null;
     window.open('','_self');
     alert("asasda");
      window.close();
    }
    </script>

</head>

<body>
    <header class="aui-bar aui-bar-nav">
        <div class="aui-pull-left aui-btn">
            <span class="aui-iconfont aui-icon-left" onclick="closewin()"></span>
        </div>
        <div class="aui-title" >测试任务</div>
    </header>
    <div style="margin-top:20px">
        <div class="left"><b>任务名称</b></div>
        <div style="display:inline;width:50%;" id="getname"></div>
    </div>
    <hr style="margin:0 auto" color=#d3d3d3 width=90% size=3>
    <!-- <HR width="90%" style="margin:0 auto" color=#d3d3d3 SIZE=3> -->
    <div>
        <b style="margin:-0 10%;line-height:60px">业主确认照片</b>
        <img style="margin-left:28%;padding:5px 15px;margin-top:20px;display:inline;width:50px;" src="../image/photo.png" />
    </div>
    <hr style="margin:0 auto;width:90%" color=#d3d3d3 size=3/>
    <div id="project_list">

    </div>
    <p class=" define-color" style="margin:50px 40px 40px 40px;border-radius:0.2rem;text-align:center;height:1.5rem;color:#000;padding: 0.3rem 0rem;color:white;font-size:16px">提交</p>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-1.4.2.min.js"></script>
<script type="text/javascript">
    var project_json = getAllInfomation();


    apiready = function() {



      var project_info = api.pageParam.name;

              $("#getname").html(project_info);
        //为传入的DOM元素增加适当的上内边距，避免header与状态栏重叠
        //设置样式
        api.setStatusBarStyle({
            style: 'dark',
            color: '#6ab494'
        });
        funIniGroup();

        //下方是用来解析json的
        var data = eval(project_json);
        var data_status = data.status;
        var data_info = data.work;



        if (data_status == "true") {
            var information = eval(data_info);
            var obj = "";
            $("#project_list").html("");
            for (var i = 0; i < information.length; i++) {
                //使用information[i]来获取一个个的json对象

                obj = '<div class="border"> <div style = "margin-top:10px;" ><div class = "left" > <b> 系统名称 </b></div> <div class = "right" style = "red;display:inline"> ' + information[i].project_name +
                    '</div></div><div><div class = "left"> <b> 系统分类 </b></div><div class = "right"style = "display:inline"> ' + information[i].project_type +
                    ' </div></div><div><div class = "left" > <b> 设施名称 </b></div><div class = "right" style = "display:inline;"> ' + information[i].task_name +
                    ' </div></div><div class = "fill"                    style = "margin-bottom:5px;padding-right:8%;margin-top:-5px;text-align:right;" onclick="doclick()"> <img src = "../image/edit.png"style = "width:28px;margin-bottom:-8px;display:inline" /> <div style = "display:inline"> 编辑 </div>  <img src = "../image/delete.png"  style = "width:20px;display:inline;margin-bottom:-6px;margin-left:20px" /> <div style = "display:inline"> 删除 </div></div></div>';



                //   //MMP
                // var differentobj = "";
                // obj = '<li class="aui-list-header"></li><li class="aui-list-item aui-list-item-arrow"><div style="color:red;text-align:right">'+information[i].project_type+'</div><div class="aui-media-list-item-inner"><div class="aui-list-item-inner"><div class="aui-list-item-text"><div class="aui-list-item-title">项目名称</div><div>'+information[i].project_name+'</div></div><div class="aui-list-item-text"><div class="aui-list-item-title">任务名称</div><div >'+information[i].task_name+'</div></div><div class="aui-list-item-text"><div class="aui-list-item-title">创建日期</div><div >'+information[i].creat_date+'</div></div><div class="aui-list-item-text"><div class="aui-list-item-title">执行状态</div><div >'+information[i].work_status;
                // if (information[i].work_status=="待接收") {
                //   differentobj =   '</div></div><div class="aui-btn aui-btn-info"  onclick="acceptTask('+i+')" style="float:right;"><span class="aui-iconfont aui-icon-edit" ></span>接收</div></div></div></li>';
                // }
                // else {
                //   differentobj =   '</div></div><div class="aui-btn aui-btn-info"  onclick="executeTask('+i+')" style="float:right;"><span class="aui-iconfont aui-icon-edit" ></span>执行</div></div></div></li>';
                // }
                // obj+=differentobj;
                $("#project_list").append(obj);
                //$api.byId('project_list').append(obj);
            }

        } else {
            alert("数据请求出错，请刷新本页面重试");
        }
        //上方是解析json的
    }


    function executeTask(index) {
        var data = eval(project_json);
        var data_status = data.status;
        var data_info = data.work;
        var information = eval(data_info);
    }

    function doclick() {
        //下方是用来解析json的

        api.openWin({
            name: 'frame2',
            url: '../html/frame2.html',
            pageParam: {
                "info": "我新建的任务名称"
            }
        });

    }


    function funIniGroup() {

        var eHeaderLis = $api.domAll('li'),
            frames = [];
        api.openFrameGroup({
            name: 'group',
            scrollEnabled: false,
            rect: {
                x: 0,
                y: 0,
                w: api.winWidth,
                // h: $api.dom('#main').offsetHeight
            },
            index: 0,
            frames: frames
        }, function(ret, err) {

        });
    }

    // 随意切换按钮
    function randomSwitchBtn(tag) {
        if (tag == $api.dom('#footer li.active')) return;
        var eFootLis = $api.domAll('#footer li'),
            eHeaderLis = $api.domAll('header li'),
            index = 0;
        for (var i = 0, len = eFootLis.length; i < len; i++) {
            if (tag == eFootLis[i]) {
                index = i;
            } else {
                $api.removeCls(eFootLis[i], 'active');
                $api.removeCls(eHeaderLis[i], 'active');
            }
        }
        $api.addCls(eFootLis[index], 'active');
        $api.addCls(eHeaderLis[index], 'active');
        api.setFrameGroupIndex({
            name: 'group',
            index: index
        });
    }


    function getAllInfomation()
    //函数用来获取json数据，并返回
    {
        var project_json = {
            "status": "true",
            "work": [{
                "project_name": "国际维保",
                "project_type": "排查",
                "task_name": "消防栓检查",
                "creat_date": "2018-03-42",
                "work_status": "待接收",
                "assign_person": "范明宇",
                "work_place": "帝国大厦",
                "work_num": "31454",
                "owner": "王权",
                "telephone": "13883474876",
                "work_description": "修下水道"

            }, {
                "project_name": "国际维保",
                "project_type": "测试",
                "task_name": "灭火器检查",
                "creat_date": "2018-03-22",
                "work_status": "已接收",
                "assign_person": "范明宇",
                "work_place": "帝国大厦",
                "work_num": "31454",
                "owner": "王权",
                "telephone": "13883474876",
                "work_description": "修下水道"
            }, {
                "project_name": "国际维保啊",
                "project_type": "排查",
                "task_name": "水泵检查",
                "creat_date": "2018-11-22",
                "work_status": "已接收",
                "assign_person": "范明宇",
                "work_place": "帝国大厦",
                "work_num": "31454",
                "owner": "王权",
                "telephone": "13883474876",
                "work_description": "修下水道"
            }]
        };
        return project_json;
    }
</script>

</html>
