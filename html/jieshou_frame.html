<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>应用</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/aui.2.0.css"/>
    <link rel="stylesheet" type="text/css" href="../css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/aui-skin.css"/>
    <style>
    </style>
</head>
<body>

    <ul id="project_list" class="aui-list aui-media-list">
      </ul>

</body>
</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-1.4.2.min.js"></script>

<script type="text/javascript">
    //json的获取需要设置为全局变量
      var project_json =  getAllInfomation();
    apiready = function () {
        //下方是用来解析json的
        var data = eval(project_json);
        var data_status = data.status;
        var data_info = data.task;
        if (data_status=="true") {
          var information = eval(data_info);
          var obj ="";
          $("#project_list").html("");
          for (var i = 0;i<information.length;i++) {
              //使用information[i]来获取一个个的json对象

              //MMP
            var differentobj = "";
            obj = '<li class="aui-list-header"></li><li class="aui-list-item aui-list-item-arrow"><div style="color:red;text-align:right">'+information[i].task_type+'</div><div class="aui-media-list-item-inner"><div class="aui-list-item-inner"><div class="aui-list-item-text"><div class="aui-list-item-title">项目名称</div><div>'+information[i].project_name+'</div></div><div class="aui-list-item-text"><div class="aui-list-item-title">任务名称</div><div >'+information[i].task_name+'</div></div><div class="aui-list-item-text"><div class="aui-list-item-title">创建日期</div><div >'+information[i].creat_time+'</div></div><div class="aui-list-item-text"><div class="aui-list-item-title">执行状态</div><div >'+information[i].task_status;
            if (information[i].task_status=="待接收") {
              differentobj =   '</div></div><div class="aui-btn aui-btn-info"  onclick="acceptTask('+i+')" style="float:right;"><span class="aui-iconfont aui-icon-edit" ></span>接收</div></div></div></li>';
            }
            else {
              differentobj =   '</div></div><div class="aui-btn aui-btn-info"  onclick="executeTask('+i+')" style="float:right;"><span class="aui-iconfont aui-icon-edit" ></span>执行</div></div></div></li>';
            }
            obj+=differentobj;
             $("#project_list").append(obj);
            //$api.byId('project_list').append(obj);
          }

        }
        else {
          alert("数据请求出错，请刷新本页面重试");
        }
        //上方是解析json的
    }


function executeTask(index)
{
  //执行任务的代码还没写，感觉跟接收任务差不多。
  var data = eval(project_json);
  var data_status = data.status;
  var data_info = data.task;
  var information = eval(data_info);
  api.openWin({
      name: 'executeTask_win',
      url: './executeTask_win.html',
      pageParam: {
          "task_info":information[index]
      }
  });
}
  function acceptTask(index)
  {
    //下方是用来解析json的
    var data = eval(project_json);
    var data_status = data.status;
    var data_info = data.task;
    var information = eval(data_info);
    api.openWin({
        name: 'acceptTask_win',
        url: './acceptTask_win.html',
        pageParam: {
            "task_info":information[index]
        }
    });

  }

    function getAllInfomation()
    //函数用来获取json数据，并返回
    {
      var project_json ={
  "status": "true",
  "task": [{
      "id":"123",
      "project_name": "国际维保",
      "task_type": "排查",
      "task_name": "消防栓检查",
      "creat_time": "2018-03-42",
      "task_status": "待执行",
      "proprietor_name": "范明宇",
      "task_location": "帝国大厦",
      "task_number": "10000",
      "issue_person": "小叮当",
      "proprietor_connector_mobile_phone": "13883474876",
      "task_description": "修下水道",
      "facility_name":"室外消火栓",
      "facility_location":"1楼西侧"
    },
    {
        "id":"123",
        "project_name": "国际维保",
        "task_type": "维护",
        "task_name": "消防栓检查",
        "creat_time": "2018-03-42",
        "task_status": "待接收",
        "proprietor_name": "范明宇",
        "task_location": "帝国大厦",
        "task_number": "10000",
        "issue_person": "小叮当",
        "proprietor_connector_mobile_phone": "13883474876",
        "task_description": "修下水道",
        "facility_name":"室外消火栓",
        "facility_location":"1楼西侧"
      },
      {
          "id":"123",
          "project_name": "国际维保",
          "task_type": "排查",
          "task_name": "消防栓检查",
          "creat_time": "2018-03-42",
          "task_status": "待接收",
          "proprietor_name": "范明宇",
          "task_location": "帝国大厦",
          "task_number": "10000",
          "issue_person": "小叮当",
          "proprietor_connector_mobile_phone": "13883474876",
          "task_description": "修下水道",
          "facility_name":"室外消火栓",
          "facility_location":"1楼西侧"
        }
  ]
};
return project_json;
    }
</script>
